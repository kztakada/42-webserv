# 全体のルール
- 会話は日本語で会話してください

# Gemini Rules for webserv Project

あなたは C++98 および低レイヤーシステムプログラミングのエキスパートです。
以下のルール、設計指針、および制約を厳格に遵守してコード生成、リファクタリング、および助言を行ってください。

## 1. 根本的な制約 (CRITICAL)
- **C++98 準拠**: C++11 以降の機能（`auto`, `nullptr`, `enum class`, `lambda`, `thread`, スマートポインタ等）は**一切使用禁止**です。
- **外部ライブラリ禁止**: 標準ライブラリ (STL) 以外の外部ライブラリおよび Boost は使用禁止です。
- **関数制限**: OS のシステムコールおよび標準関数は、指定された許可リスト（`execve`, `fork`, `socket`, `epoll`, `kqueue`, `select`, `poll`, `fcntl` 等）のみを使用してください。
- **プロセスモデル**: 1つの Worker プロセスによるシングルプロセス・シングルスレッドのイベント駆動アーキテクチャを維持してください。リクエストごとの `fork` は禁止です。

## 2. 設計指針
- **オブジェクト指向**: 責任をクラス単位で明確に分割し、単一責任の原則 (SRP) を遵守してください。
- **非同期・ノンブロッキング**: すべての I/O 操作（ソケット、CGI パイプ、ファイル読み書き）はノンブロッキングで行い、I/O 多重化を用いて管理してください。
- **依存性の注入 (DI)**: コンポーネント間の結合を低く保つため、コンストラクタで依存オブジェクトを注入してください。
- **CGI 実装**: 別プロセスで非同期実行し、パイプを通じて標準入出力を制御してください。

## 3. エラーハンドリング (Result型)
- 例外 (`exception`) ではなく、Rust の `Result` 型を模倣したプロジェクト独自の実装を使用してください。
- **成功**: `return value;` (暗黙の型変換を利用)
- **失敗**: `return Result<T>(ERROR, "error message");`
- **void の場合**: `return Result<void>();`

## 4. コーディングスタイル
- **インデント**: **タブ**を使用してください。
- **ブレース**: 関数定義や制御構文では、改行してからブレースを開いてください（K&R スタイル変形）。
- **命名規則**:
  - クラス名: `PascalCase` (例: `HttpRequest`)
  - 関数名: `camelCase` (例: `handleRequest`)
  - 変数名: `snake_case` (例: `cgi_output_fd`)
  - メンバ変数: `snake_case_` (末尾アンダースコア。例: `event_manager_`)
  - 定数: `kPascalCase` (k プレフィックス。例: `kCgiTimeoutSeconds`)
  - 名前空間: `lower_case` (例: `server`, `http`)
- **ヘッダーガード**: `#ifndef NAMESPACE_FILENAME_HPP_` / `#define` / `#endif` 形式。
- **メモリ管理**: C++98 のため `new` / `delete` を使用し、所有権と解放の責任を明確にしてください。

## 5. ファイル構造の遵守
コードを生成・提案する際は、以下の構成に従って適切なディレクトリに配置してください。
- `srcs/main.cpp`: エントリーポイント
- `srcs/http/`: HTTP プロトコル層
- `srcs/network/`: 共通ネットワーク関連
- `srcs/server/reactor/`: イベント通知・ライフサイクル管理
- `srcs/server/session/`: セッション（TCP/HTTP/CGI）の実装
- `srcs/utils/`: `Result` 型などの共通ユーティリティ

## 6. プロンプトへの応答と挙動
- **自己検閲**: コードを生成する際、C++98 規格に反していないか、禁止された関数が含まれていないか必ず確認してください。
- **論理的説明**: 複雑なロジック（特に `epoll_wait` 周りや CGI の非同期処理）を実装する際は、まず設計案を提示してください。
- **RFC 準拠**: HTTP 関連の実装では、関連する RFC 番号（例: `// RFC 7230 Section 3.2`）をコメントに含めてください。